# This file is automatically generated

name: Clear Workflow Runs CI

on:
  workflow_dispatch:
  schedule:
    - cron: "0 0 * * 0"

jobs:
  clear-workflow-runs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Clear all workflow runs
        env:
          TOKEN: ${{ secrets.TOKEN }}
        run: |
          echo "${TOKEN}" | gh auth login --with-token
          runs=$(gh api repos/hydazz/docker-jackett/actions/runs | jq -r .total_count)
          while true; do
          	if [[ $(gh api repos/hydazz/docker-jackett/actions/runs | jq -r .total_count) != 0 ]]; then
          		if [[ $(gh api repos/hydazz/docker-jackett/actions/runs | jq -r .total_count) != "$runs" ]]; then
          			echo "not all runs deleted, running again"
          		fi
          		gh api repos/hydazz/docker-jackett/actions/runs \
          			--paginate -q '.workflow_runs[] | "\(.id)"' |
          			xargs -n1 -I % gh api repos/hydazz/docker-jackett/actions/runs/% -X DELETE
          	else
          		echo "Deleted $runs runs"
          		exit
          	fi
          done
